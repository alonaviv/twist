{% load static %}

<!DOCTYPE html>
<html lang="en">
    <head>
        <meta charset="UTF-8">
        <meta http-equiv="X-UA-Compatible" content="IE=edge">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        <meta name="robots" content="noindex, nofollow" />

        <title>Broadway With a Twist â€“ Pub Quiz</title>

        <script src="https://kit.fontawesome.com/4078bed46b.js" crossorigin="anonymous"></script>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Roboto:ital,wght@0,300;0,400;0,500;0,600;0,700;1,300&display=swap">
        <link rel="stylesheet" href="{% static 'pub_quiz/css/main.css' %}">
    </head>

    <body>
        <main class="pq-page">
            <header class="pq-hero">
                <h1 class="pq-title">Welcome to Broadway With a Twist: Pub Quiz</h1>
                <div class="pq-logo-wrapper">
                    <img src="{% static 'pub_quiz/img/pub_quiz_logo.png' %}"
                         alt="Broadway With a Twist Pub Quiz"
                         class="pq-logo">
                </div>
                <p class="pq-next-event-label">When's the next event??</p>
                <p class="pq-whatsapp-link">
                    <a href="https://links.broadwaywithatwist.xyz/whatsapp?utm_source=pub-quiz-page&utm_campaign=webapp&utm_content=pub-quiz-whatsapp" target="_blank" rel="noopener noreferrer"><i class="fa-brands fa-whatsapp"></i> Join our silent WhatsApp group!</a>
                </p>
                <p class="pq-choose-label">Choose your round</p>
                <nav class="pq-rounds">
                    {% for round in round_links %}
                    {% if round.configured %}
                    <a href="#" class="pq-round-btn" data-round="{{ round.number }}" data-configured="true">Round {{ round.number }}</a>
                    {% else %}
                    <a href="{% url 'pub_quiz:round_no_link_number' round.number %}" class="pq-round-btn">Round {{ round.number }}</a>
                    {% endif %}
                    {% endfor %}
                </nav>
            </header>
        </main>
        <script>
        (function () {
            var buttons = document.querySelectorAll('.pq-round-btn[data-configured=\"true\"]');
            buttons.forEach(function (btn) {
                btn.addEventListener('click', function (event) {
                    event.preventDefault();
                    var roundNumber = this.getAttribute('data-round');
                    var password = window.prompt('Enter the password for Round ' + roundNumber + ':');
                    if (password === null || password === '') {
                        return;
                    }
                    fetch('/pub-quiz/round/' + roundNumber + '/check/', {
                        method: 'POST',
                        headers: {
                            'Content-Type': 'application/json'
                        },
                        body: JSON.stringify({password: password})
                    }).then(function (resp) {
                        return resp.json();
                    }).then(function (data) {
                        if (data.ok && data.url) {
                            window.location.href = data.url;
                        } else {
                            alert(data.error || 'Wrong password, try again.');
                        }
                    }).catch(function () {
                        alert('Something went wrong. Please try again.');
                    });
                });
            });
        })();
        </script>
    </body>
</html>
